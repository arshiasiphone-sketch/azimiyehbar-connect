// =====================================================
// Karaj Barbari - Prisma Schema
// Reference schema for future migration to Prisma
// =====================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =====================================================
// ENUMS
// =====================================================

enum AppRole {
  admin
  user
}

enum BookingStatus {
  pending
  confirmed
  in_progress
  completed
  cancelled
}

enum ServiceType {
  intercity
  local
  furniture
  van
  truck
  packing
}

// =====================================================
// MODELS
// =====================================================

/// پروفایل کاربران
model Profile {
  id        String   @id @default(uuid()) @db.Uuid
  fullName  String?  @map("full_name")
  avatarUrl String?  @map("avatar_url")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  userRoles UserRole[]

  @@map("profiles")
}

/// نقش‌های کاربران
model UserRole {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  role      AppRole
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  profile Profile @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, role])
  @@index([userId])
  @@index([role])
  @@map("user_roles")
}

/// خدمات
model Service {
  id          String   @id @default(uuid()) @db.Uuid
  title       String
  description String?
  icon        String?
  features    String[]
  priceFrom   Int?     @map("price_from")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@index([isActive])
  @@index([createdAt(sort: Desc)])
  @@map("services")
}

/// رزروها
model Booking {
  id          String        @id @default(uuid()) @db.Uuid
  fullName    String        @map("full_name")
  phone       String
  origin      String
  destination String
  serviceType ServiceType   @map("service_type")
  bookingDate DateTime?     @map("booking_date") @db.Date
  description String?
  status      BookingStatus @default(pending)
  createdAt   DateTime      @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime      @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@index([status])
  @@index([createdAt(sort: Desc)])
  @@index([phone])
  @@index([serviceType])
  @@map("bookings")
}

/// پیام‌های تماس
model ContactMessage {
  id        String   @id @default(uuid()) @db.Uuid
  name      String
  phone     String
  email     String?
  message   String
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@index([isRead])
  @@index([createdAt(sort: Desc)])
  @@map("contact_messages")
}

/// گالری
model Gallery {
  id        String   @id @default(uuid()) @db.Uuid
  title     String
  imageUrl  String   @map("image_url")
  category  String?
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@index([isActive])
  @@index([category])
  @@index([createdAt(sort: Desc)])
  @@map("gallery")
}
